.data $interrupt
.data $systrap
JUMP $startup__
POP
HALT
; 0 interrupt

interrupt:
PUSH 0
RETURNV
; 0 systrap

systrap:
PUSH 0
RETURNV
; 0 startup__

startup__:
CALL $main
POP
HALT
PUSH 0
RETURNV
; 0 sys_prints

sys_prints:
PUSHVAR -12
OUTS
PUSH 0
RETURNV
PUSH 0
RETURNV
.dataseg
BP_REG:
.data 0
.codeseg
.dataseg
LP_REG:
.data 1
.codeseg
.dataseg
IP_REG:
.data 2
.codeseg
.dataseg
SP_REG:
.data 3
.codeseg
.dataseg
FP_REG:
.data 4
.codeseg
.dataseg
FLAG_REG:
.data 5
.codeseg
.dataseg
WORD_SIZE:
.data 4
.codeseg
.dataseg
FL_HALTED:
.data 1
.codeseg
.dataseg
FL_USER_MODE:
.data 2
.codeseg
.dataseg
FL_INT_MODE:
.data 4
.codeseg
.dataseg
FL_INT_DIS:
.data 8
.codeseg
.dataseg
FL_INT_PENDING:
.data 16
.codeseg
.dataseg
FL_VMEM:
.data 32
.codeseg
; 0 strlen

strlen:
ADJSP 8
PUSH 0
DUP
PUSH 0
PUSHFP
PLUS
POPVARIND
POP
LABEL_2:
PUSHVAR -12
PUSHCVARIND
PUSH 0
NE
JUMPE $LABEL_3
PUSHVAR 0
PUSH 1
PLUS
DUP
PUSH 0
PUSHFP
PLUS
POPVARIND
POP
PUSHVAR -12
PUSH 1
PLUS
DUP
PUSH -12
PUSHFP
PLUS
POPVARIND
POP
JUMP $LABEL_2
LABEL_3:
PUSHVAR 0
RETURNV
PUSH 0
RETURNV
; 0 strcpy

strcpy:
ADJSP 8
PUSHVAR -12
DUP
PUSH 0
PUSHFP
PLUS
POPVARIND
POP
LABEL_4:
PUSHVAR -16
PUSHCVARIND
PUSH 0
NE
JUMPE $LABEL_5
PUSHVAR -16
PUSHCVARIND
DUP
PUSHVAR 0
POPCVARIND
POP
PUSHVAR 0
PUSH 1
PLUS
DUP
PUSH 0
PUSHFP
PLUS
POPVARIND
POP
PUSHVAR -16
PUSH 1
PLUS
DUP
PUSH -16
PUSHFP
PLUS
POPVARIND
POP
JUMP $LABEL_4
LABEL_5:
PUSH 0
DUP
PUSHVAR 0
POPCVARIND
POP
PUSHVAR -12
RETURNV
PUSH 0
RETURNV
; 0 strncpy

strncpy:
ADJSP 12
PUSHVAR -12
DUP
PUSH 0
PUSHFP
PLUS
POPVARIND
POP
PUSH 0
DUP
PUSH 4
PUSHFP
PLUS
POPVARIND
POP
LABEL_6:
PUSHVAR -16
PUSHCVARIND
PUSH 0
NE
DUP
JUMPE $LABEL_8
PUSHVAR 4
PUSHVAR -20
LT
AND
LABEL_8:
JUMPE $LABEL_7
PUSHVAR -16
PUSHCVARIND
DUP
PUSHVAR 0
POPCVARIND
POP
PUSHVAR 0
PUSH 1
PLUS
DUP
PUSH 0
PUSHFP
PLUS
POPVARIND
POP
PUSHVAR -16
PUSH 1
PLUS
DUP
PUSH -16
PUSHFP
PLUS
POPVARIND
POP
PUSHVAR 4
PUSH 1
PLUS
DUP
PUSH 4
PUSHFP
PLUS
POPVARIND
POP
JUMP $LABEL_6
LABEL_7:
PUSHVAR 4
DUP
PUSH 4
PUSHFP
PLUS
POPVARIND
POP
LABEL_9:
PUSHVAR 4
PUSHVAR -20
LT
JUMPE $LABEL_10
PUSH 0
DUP
PUSHVAR -12
PUSHVAR 4
PLUS
POPCVARIND
POP
PUSHVAR 4
PUSH 1
PLUS
DUP
PUSH 4
PUSHFP
PLUS
POPVARIND
POP
JUMP $LABEL_9
LABEL_10:
PUSHVAR -12
RETURNV
PUSH 0
RETURNV
; 0 strchr

strchr:
LABEL_11:
PUSHVAR -12
PUSHCVARIND
PUSHVAR -16
NE
DUP
JUMPE $LABEL_13
PUSHVAR -12
PUSHCVARIND
AND
LABEL_13:
JUMPE $LABEL_12
PUSHVAR -12
PUSH 1
PLUS
DUP
PUSH -12
PUSHFP
PLUS
POPVARIND
POP
JUMP $LABEL_11
LABEL_12:
PUSHVAR -12
PUSHCVARIND
PUSHVAR -16
NE
JUMPE $LABEL_14
PUSH 0
RETURNV
LABEL_14:
PUSHVAR -12
RETURNV
PUSH 0
RETURNV
; 0 strcmp

strcmp:
ADJSP 12
LABEL_15:
PUSHVAR -12
PUSHCVARIND
PUSH 0
NE
DUP
JUMPE $LABEL_18
JUMP $LABEL_17
LABEL_18:
PUSHVAR -16
PUSHCVARIND
PUSH 0
NE
OR
LABEL_17:
JUMPE $LABEL_16
PUSHVAR -12
PUSHCVARIND
PUSHVAR -16
PUSHCVARIND
MINUS
DUP
PUSH 4
PUSHFP
PLUS
POPVARIND
POP
PUSHVAR 4
PUSH 0
NE
JUMPE $LABEL_19
PUSHVAR 4
RETURNV
LABEL_19:
PUSHVAR -12
PUSH 1
PLUS
DUP
PUSH -12
PUSHFP
PLUS
POPVARIND
POP
PUSHVAR -16
PUSH 1
PLUS
DUP
PUSH -16
PUSHFP
PLUS
POPVARIND
POP
JUMP $LABEL_15
LABEL_16:
PUSH 0
RETURNV
PUSH 0
RETURNV
; 0 strrev

strrev:
ADJSP 16
PUSHVAR -12
PUSH 0
EQ
JUMPE $LABEL_20
PUSH 0
RETURNV
LABEL_20:
PUSHVAR -12
DUP
PUSH 4
PUSHFP
PLUS
POPVARIND
POP
PUSHVAR -12
DUP
PUSH 0
PUSHFP
PLUS
POPVARIND
POP
LABEL_21:
PUSHVAR 4
PUSHCVARIND
JUMPE $LABEL_22
PUSHVAR 4
PUSH 1
PLUS
DUP
PUSH 4
PUSHFP
PLUS
POPVARIND
POP
JUMP $LABEL_21
LABEL_22:
PUSHVAR 4
PUSH 1
MINUS
DUP
PUSH 4
PUSHFP
PLUS
POPVARIND
POP
LABEL_23:
PUSHVAR 0
PUSHVAR 4
LT
JUMPE $LABEL_24
PUSHVAR 0
PUSHCVARIND
DUP
PUSH 8
PUSHFP
PLUS
POPVARIND
POP
PUSHVAR 4
PUSHCVARIND
DUP
PUSHVAR 0
POPCVARIND
POP
PUSHVAR 8
DUP
PUSHVAR 4
POPCVARIND
POP
PUSHVAR 0
PUSH 1
PLUS
DUP
PUSH 0
PUSHFP
PLUS
POPVARIND
POP
PUSHVAR 4
PUSH 1
MINUS
DUP
PUSH 4
PUSHFP
PLUS
POPVARIND
POP
JUMP $LABEL_23
LABEL_24:
PUSHVAR -12
RETURNV
PUSH 0
RETURNV
; 0 itostr

itostr:
ADJSP 12
PUSH 0
DUP
PUSH 4
PUSHFP
PLUS
POPVARIND
POP
PUSHVAR -16
DUP
PUSH 0
PUSHFP
PLUS
POPVARIND
POP
PUSHVAR -12
PUSH 0
EQ
JUMPE $LABEL_25
PUSH 48
DUP
PUSHVAR -16
PUSH 0
PLUS
POPCVARIND
POP
PUSH 0
DUP
PUSHVAR -16
PUSH 1
PLUS
POPCVARIND
POP
PUSHVAR -16
RETURNV
LABEL_25:
PUSHVAR -12
PUSH 0
LT
JUMPE $LABEL_26
PUSH 1
DUP
PUSH 4
PUSHFP
PLUS
POPVARIND
POP
PUSHVAR -12
NEG
DUP
PUSH -12
PUSHFP
PLUS
POPVARIND
POP
LABEL_26:
LABEL_27:
PUSHVAR -12
PUSH 0
GT
JUMPE $LABEL_28
PUSHVAR -12
PUSH 10
MOD
PUSH 48
PLUS
DUP
PUSHVAR 0
POPCVARIND
POP
PUSHVAR 0
PUSH 1
PLUS
DUP
PUSH 0
PUSHFP
PLUS
POPVARIND
POP
PUSHVAR -12
PUSH 10
DIVIDE
DUP
PUSH -12
PUSHFP
PLUS
POPVARIND
POP
JUMP $LABEL_27
LABEL_28:
PUSHVAR 4
JUMPE $LABEL_29
PUSH 45
DUP
PUSHVAR 0
POPCVARIND
POP
PUSHVAR 0
PUSH 1
PLUS
DUP
PUSH 0
PUSHFP
PLUS
POPVARIND
POP
LABEL_29:
PUSH 0
DUP
PUSHVAR 0
POPCVARIND
POP
PUSHVAR -16
CALL $strrev
SWAP
POP
POP
PUSHVAR -16
RETURNV
PUSH 0
RETURNV
.dataseg
PRINTS_CALL:
.data 1
.codeseg
.dataseg
EXIT_CALL:
.data 2
.codeseg
.dataseg
HALT_CALL:
.data 3
.codeseg
.dataseg
PRINT_OP:
.data 4
.codeseg
.dataseg
GETL_CALL:
.data 6
.codeseg
.dataseg
GETS_CALL:
.data 5
.codeseg
.dataseg
GETI_CALL:
.data 7
.codeseg
.dataseg
EXEC_CALL:
.data 8
.codeseg
.dataseg
IO_QUEUED:
.data 268435456
.codeseg
.dataseg
IO_PENDING:
.data 536870912
.codeseg
.dataseg
IO_ERROR:
.data 1073741824
.codeseg
.dataseg
IO_COMPLETE:
.data -2147483648
.codeseg
; 0 syscall

syscall:
ADJSP 20
PUSH 0
DUP
PUSH 0
PUSHFP
PLUS
POPVARIND
POP
PUSHVAR -12
DUP
PUSH 4
PUSHFP
PLUS
PUSH 0
PLUS
POPVARIND
POP
PUSHREG 1
DUP
PUSH 0
PUSHFP
PLUS
POPVARIND
POP
PUSHVAR -12
PUSH 4
EQ
JUMPE $LABEL_30
PUSHVAR -16
PUSH 0
LT
DUP
JUMPE $LABEL_33
JUMP $LABEL_32
LABEL_33:
PUSHVAR -16
PUSHVAR 0
GT
OR
LABEL_32:
JUMPE $LABEL_31
PUSH 1
NEG
RETURNV
LABEL_31:
TRAP
PUSH 0
RETURNV
JUMP $LABEL_34
LABEL_30:
PUSHVAR -12
PUSH 7
EQ
JUMPE $LABEL_35
PUSHVAR -20
DUP
PUSH 4
PUSHFP
PLUS
PUSH 4
PLUS
POPVARIND
POP
PUSHVAR -20
PUSH 0
LT
DUP
JUMPE $LABEL_38
JUMP $LABEL_37
LABEL_38:
PUSHVAR -20
PUSHVAR 0
GT
OR
LABEL_37:
JUMPE $LABEL_36
PUSH 1
NEG
RETURNV
LABEL_36:
TRAP
PUSH 0
RETURNV
JUMP $LABEL_39
LABEL_35:
PUSHVAR -12
PUSH 6
EQ
JUMPE $LABEL_40
PUSHVAR -16
DUP
PUSH 4
PUSHFP
PLUS
PUSH 4
PLUS
POPVARIND
POP
PUSHVAR -16
PUSH 0
LT
DUP
JUMPE $LABEL_43
JUMP $LABEL_42
LABEL_43:
PUSHVAR -16
PUSHVAR 0
GT
OR
LABEL_42:
JUMPE $LABEL_41
PUSH 1
NEG
RETURNV
LABEL_41:
TRAP
PUSH 0
RETURNV
LABEL_40:
LABEL_39:
LABEL_34:
PUSH 1
NEG
RETURNV
PUSH 0
RETURNV
; 0 sys_prints

sys_prints:
PUSHVAR -12
OUTS
PUSH 0
RETURNV
PUSH 0
RETURNV
; 0 prints

prints:
ADJSP 8
PUSH 0
DUP
PUSH 0
PUSHFP
PLUS
POPVARIND
POP
PUSH 0
PUSHVAR -12
PUSH 4
CALL $syscall
SWAP
POP
SWAP
POP
SWAP
POP
DUP
PUSH 0
PUSHFP
PLUS
POPVARIND
POP
PUSHVAR 0
RETURNV
PUSH 0
RETURNV
; 0 printi

printi:
ADJSP 20
PUSH 0
DUP
PUSH 0
PUSHFP
PLUS
POPVARIND
POP
PUSH 4
PUSHFP
PLUS
PUSHVAR -12
CALL $itostr
SWAP
POP
SWAP
POP
POP
PUSH 4
PUSHFP
PLUS
CALL $prints
SWAP
POP
DUP
PUSH 0
PUSHFP
PLUS
POPVARIND
POP
PUSH 0
RETURNV
PUSH 0
RETURNV
; 0 geti

geti:
ADJSP 12
PUSH 0
DUP
PUSH 0
PUSHFP
PLUS
POPVARIND
POP
PUSH 0
DUP
PUSH 4
PUSHFP
PLUS
POPVARIND
POP
PUSH 4
PUSHFP
PLUS
PUSH $LABEL_44
.dataseg
LABEL_44:
.string ""
.codeseg
PUSH 7
CALL $syscall
SWAP
POP
SWAP
POP
SWAP
POP
DUP
PUSH 0
PUSHFP
PLUS
POPVARIND
POP
PUSHVAR 4
RETURNV
PUSH 0
RETURNV
; 0 gets

gets:
PUSH 0
PUSHVAR -12
PUSH 6
CALL $syscall
SWAP
POP
SWAP
POP
SWAP
POP
POP
PUSH 0
RETURNV
PUSH 0
RETURNV
; 0 halt

halt:
PUSH 0
PUSH 3
CALL $syscall
SWAP
POP
SWAP
POP
POP
PUSH 0
RETURNV
; 0 main

main:
ADJSP 108
PUSH 0
DUP
PUSH 100
PUSHFP
PLUS
POPVARIND
POP
PUSH $LABEL_45
.dataseg
LABEL_45:
.string "Hello world\n"
.codeseg
CALL $prints
SWAP
POP
POP
PUSH 0
PUSHFP
PLUS
CALL $gets
SWAP
POP
POP
PUSH 0
PUSHFP
PLUS
CALL $prints
SWAP
POP
POP
PUSH 1
CALL $printi
SWAP
POP
POP
PUSH $LABEL_46
.dataseg
LABEL_46:
.string "\n"
.codeseg
CALL $prints
SWAP
POP
POP
CALL $geti
DUP
PUSH 100
PUSHFP
PLUS
POPVARIND
POP
PUSHVAR 100
CALL $printi
SWAP
POP
POP
PUSH $LABEL_47
.dataseg
LABEL_47:
.string "\n"
.codeseg
CALL $prints
SWAP
POP
POP
PUSH 0
RETURNV
PUSH 0
RETURNV
